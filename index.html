<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web App Presensi 2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .spreadsheet-table {
            font-size: 12px;
        }
        .spreadsheet-table th,
        .spreadsheet-table td {
            border: 1px solid #e5e7eb;
            padding: 4px 8px;
            text-align: center;
        }
        .spreadsheet-table th {
            background-color: #f3f4f6;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .spreadsheet-table .student-name {
            text-align: left;
            font-weight: 500;
            background-color: #f9fafb;
            position: sticky;
            left: 0;
            z-index: 5;
        }
        .present { background-color: #dcfce7; color: #166534; }
        .absent { background-color: #fecaca; color: #dc2626; }
        .grade-a { background-color: #dcfce7; color: #166534; }
        .grade-b { background-color: #dbeafe; color: #1d4ed8; }
        .grade-c { background-color: #fef3c7; color: #d97706; }
        .grade-d { background-color: #fecaca; color: #dc2626; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="gradient-bg text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold flex items-center">
                <i class="fas fa-graduation-cap mr-2"></i>
                Presensi 2.0
            </h1>
            <div class="flex space-x-4">
                <button onclick="showPage('home')" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-all">
                    <i class="fas fa-home mr-2"></i>Home
                </button>
                <button onclick="showPage('teacher-login')" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-all">
                    <i class="fas fa-chalkboard-teacher mr-2"></i>Guru
                </button>
                <button onclick="showPage('student')" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-all">
                    <i class="fas fa-user-graduate mr-2"></i>Siswa
                </button>
            </div>
        </div>
    </nav>

    <!-- Home Page -->
    <div id="home-page" class="page fade-in">
        <div class="container mx-auto px-4 py-12">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">Selamat Datang di Sistem Presensi 2.0</h2>
                <p class="text-xl text-gray-600 mb-8">Kelola presensi dan nilai siswa dengan mudah dan efisien</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                <div class="bg-white rounded-xl p-8 card-shadow text-center">
                    <div class="text-6xl text-blue-500 mb-4">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Portal Guru</h3>
                    <p class="text-gray-600 mb-6">Kelola presensi siswa, input nilai, dan lihat rekap kelas</p>
                    <button onclick="showPage('teacher-login')" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold">
                        Masuk sebagai Guru
                    </button>
                </div>
                
                <div class="bg-white rounded-xl p-8 card-shadow text-center">
                    <div class="text-6xl text-green-500 mb-4">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Portal Siswa</h3>
                    <p class="text-gray-600 mb-6">Lihat presensi dan nilai Anda dengan mudah</p>
                    <button onclick="showPage('student')" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold">
                        Lihat Data Siswa
                    </button>
                </div>


            </div>
        </div>
    </div>

    <!-- Teacher Login Page -->
    <div id="teacher-login-page" class="page hidden fade-in">
        <div class="container mx-auto px-4 py-12">
            <div class="max-w-md mx-auto bg-white rounded-xl p-8 card-shadow">
                <div class="text-center mb-8">
                    <i class="fas fa-chalkboard-teacher text-5xl text-blue-500 mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Login Guru</h2>
                </div>
                
                <form onsubmit="teacherLogin(event)">
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                        <input type="password" id="teacher-password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" placeholder="Masukkan password">
                    </div>
                    

                    
                    <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">
                        <i class="fas fa-sign-in-alt mr-2"></i>Masuk
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Teacher Dashboard -->
    <div id="teacher-dashboard-page" class="page hidden fade-in">
        <div class="container mx-auto px-4 py-8">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800">Dashboard Guru</h2>
                <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- Kelas 7 -->
                <div class="bg-white rounded-lg p-4 card-shadow">
                    <h3 class="text-lg font-bold text-gray-800 mb-3 text-center">Kelas 7</h3>
                    <div class="space-y-2">
                        <button onclick="selectClass('7.1')" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition-all">7.1</button>
                        <button onclick="selectClass('7.2')" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition-all">7.2</button>
                        <button onclick="selectClass('7.3')" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition-all">7.3</button>
                        <button onclick="selectClass('7.4')" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition-all">7.4</button>
                    </div>
                </div>
                
                <!-- Kelas 8 -->
                <div class="bg-white rounded-lg p-4 card-shadow">
                    <h3 class="text-lg font-bold text-gray-800 mb-3 text-center">Kelas 8</h3>
                    <div class="space-y-2">
                        <button onclick="selectClass('8.1')" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 transition-all">8.1</button>
                        <button onclick="selectClass('8.2')" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 transition-all">8.2</button>
                        <button onclick="selectClass('8.3')" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 transition-all">8.3</button>
                        <button onclick="selectClass('8.4')" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 transition-all">8.4</button>
                    </div>
                </div>
                
                <!-- Kelas 9 -->
                <div class="bg-white rounded-lg p-4 card-shadow">
                    <h3 class="text-lg font-bold text-gray-800 mb-3 text-center">Kelas 9</h3>
                    <div class="space-y-2">
                        <button onclick="selectClass('9.1')" class="w-full bg-yellow-500 text-white py-2 rounded hover:bg-yellow-600 transition-all">9.1</button>
                        <button onclick="selectClass('9.2')" class="w-full bg-yellow-500 text-white py-2 rounded hover:bg-yellow-600 transition-all">9.2</button>
                        <button onclick="selectClass('9.3')" class="w-full bg-yellow-500 text-white py-2 rounded hover:bg-yellow-600 transition-all">9.3</button>
                        <button onclick="selectClass('9.4')" class="w-full bg-yellow-500 text-white py-2 rounded hover:bg-yellow-600 transition-all">9.4</button>
                    </div>
                </div>
                
                <!-- Kelas X -->
                <div class="bg-white rounded-lg p-4 card-shadow">
                    <h3 class="text-lg font-bold text-gray-800 mb-3 text-center">Kelas X</h3>
                    <div class="space-y-2">
                        <button onclick="selectClass('X.A')" class="w-full bg-purple-500 text-white py-2 rounded hover:bg-purple-600 transition-all">X.A</button>
                        <button onclick="selectClass('X.B')" class="w-full bg-purple-500 text-white py-2 rounded hover:bg-purple-600 transition-all">X.B</button>
                    </div>
                </div>
                
                <!-- Kelas XI -->
                <div class="bg-white rounded-lg p-4 card-shadow">
                    <h3 class="text-lg font-bold text-gray-800 mb-3 text-center">Kelas XI</h3>
                    <div class="space-y-2">
                        <button onclick="selectClass('XI.A')" class="w-full bg-indigo-500 text-white py-2 rounded hover:bg-indigo-600 transition-all">XI.A</button>
                        <button onclick="selectClass('XI.B')" class="w-full bg-indigo-500 text-white py-2 rounded hover:bg-indigo-600 transition-all">XI.B</button>
                    </div>
                </div>
                
                <!-- Kelas XII -->
                <div class="bg-white rounded-lg p-4 card-shadow">
                    <h3 class="text-lg font-bold text-gray-800 mb-3 text-center">Kelas XII</h3>
                    <div class="space-y-2">
                        <button onclick="selectClass('XII.A')" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600 transition-all">XII.A</button>
                        <button onclick="selectClass('XII.B')" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600 transition-all">XII.B</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Class Management Page -->
    <div id="class-management-page" class="page hidden fade-in">
        <div class="container mx-auto px-4 py-8">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <button onclick="showPage('teacher-dashboard')" class="text-blue-500 hover:text-blue-700 mb-2">
                        <i class="fas fa-arrow-left mr-2"></i>Kembali ke Dashboard
                    </button>
                    <h2 class="text-3xl font-bold text-gray-800">Kelola Kelas <span id="current-class"></span></h2>
                </div>
                <div class="flex space-x-2">
                    <button onclick="showTab('attendance')" id="attendance-tab" class="px-4 py-2 bg-blue-500 text-white rounded-lg">
                        <i class="fas fa-check-circle mr-2"></i>Presensi
                    </button>
                    <button onclick="showTab('grades')" id="grades-tab" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg">
                        <i class="fas fa-star mr-2"></i>Nilai
                    </button>
                    <button onclick="showTab('recap')" id="recap-tab" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg">
                        <i class="fas fa-chart-bar mr-2"></i>Rekap
                    </button>
                    <button onclick="showTab('spreadsheet')" id="spreadsheet-tab" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg">
                        <i class="fas fa-table mr-2"></i>Spreadsheet
                    </button>
                </div>
            </div>

            <!-- Attendance Tab -->
            <div id="attendance-content" class="tab-content">
                <div class="bg-white rounded-xl p-6 card-shadow mb-6">
                    <div class="flex flex-wrap gap-4 items-center mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Pertemuan</label>
                            <select id="meeting-select" class="border border-gray-300 rounded-lg px-3 py-2">
                                <option value="1">Pertemuan 1</option>
                                <option value="2">Pertemuan 2</option>
                                <option value="3">Pertemuan 3</option>
                                <option value="4">Pertemuan 4</option>
                                <option value="5">Pertemuan 5</option>
                                <option value="6">Pertemuan 6</option>
                                <option value="7">Pertemuan 7</option>
                                <option value="8">Pertemuan 8</option>
                                <option value="9">Pertemuan 9</option>
                                <option value="10">Pertemuan 10</option>
                                <option value="11">Pertemuan 11</option>
                                <option value="12">Pertemuan 12</option>
                                <option value="13">Pertemuan 13</option>
                                <option value="14">Pertemuan 14</option>
                                <option value="15">Pertemuan 15</option>
                                <option value="16">Pertemuan 16</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                            <input type="date" id="meeting-date" class="border border-gray-300 rounded-lg px-3 py-2">
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="markAllPresent()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all">
                                <i class="fas fa-check-double mr-2"></i>Hadir Semua
                            </button>
                            <button onclick="addStudent()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-all">
                                <i class="fas fa-user-plus mr-2"></i>Tambah Siswa
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">No</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama Siswa</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Kehadiran</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="attendance-table">
                                <!-- Students will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Grades Tab -->
            <div id="grades-content" class="tab-content hidden">
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">No</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama Siswa</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Tugas 1</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Tugas 2</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Tugas 3</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Tugas 4</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">UTS</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">UAS</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Nilai Akhir</th>
                                </tr>
                            </thead>
                            <tbody id="grades-table">
                                <!-- Grades will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Spreadsheet Tab -->
            <div id="spreadsheet-content" class="tab-content hidden">
                <div class="bg-white rounded-xl p-6 card-shadow mb-6">
                    <div class="flex flex-wrap gap-4 items-center mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tampilan</label>
                            <select id="class-spreadsheet-view" class="border border-gray-300 rounded-lg px-3 py-2" onchange="loadClassSpreadsheetData()">
                                <option value="attendance">Presensi</option>
                                <option value="grades">Nilai</option>
                                <option value="complete">Lengkap</option>
                            </select>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="exportClassToCSV()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all">
                                <i class="fas fa-download mr-2"></i>Export CSV
                            </button>
                            <button onclick="exportClassToExcel()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-all">
                                <i class="fas fa-file-excel mr-2"></i>Export Excel
                            </button>
                        </div>
                    </div>

                    <div id="class-spreadsheet-container" class="overflow-auto max-h-96 border border-gray-300 rounded-lg">
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-table text-4xl mb-4"></i>
                            <p>Data spreadsheet akan ditampilkan di sini</p>
                        </div>
                    </div>
                </div>

                <!-- Summary Statistics -->
                <div id="class-spreadsheet-stats">
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-white rounded-xl p-6 card-shadow">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">
                                <i class="fas fa-users mr-2 text-blue-500"></i>Statistik Kelas
                            </h3>
                            <div id="class-stats-spreadsheet">
                                <!-- Class statistics will be populated here -->
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-6 card-shadow">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">
                                <i class="fas fa-calendar-check mr-2 text-green-500"></i>Kehadiran
                            </h3>
                            <div id="attendance-summary-spreadsheet">
                                <!-- Attendance summary will be populated here -->
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-6 card-shadow">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">
                                <i class="fas fa-star mr-2 text-yellow-500"></i>Nilai
                            </h3>
                            <div id="grades-summary-spreadsheet">
                                <!-- Grades summary will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recap Tab -->
            <div id="recap-content" class="tab-content hidden">
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl p-6 card-shadow">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-chart-pie mr-2 text-blue-500"></i>Statistik Kehadiran
                        </h3>
                        <div id="attendance-stats">
                            <!-- Attendance statistics will be populated here -->
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 card-shadow">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-trophy mr-2 text-yellow-500"></i>Statistik Nilai
                        </h3>
                        <div id="grade-stats">
                            <!-- Grade statistics will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 card-shadow mt-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-table mr-2 text-green-500"></i>Rekap Lengkap
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">No</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama Siswa</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Kehadiran (%)</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Rata-rata Tugas</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">UTS</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">UAS</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Nilai Akhir</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">Grade</th>
                                </tr>
                            </thead>
                            <tbody id="recap-table">
                                <!-- Recap will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Page -->
    <div id="student-page" class="page hidden fade-in">
        <div class="container mx-auto px-4 py-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Portal Siswa</h2>
            
            <div class="max-w-2xl mx-auto bg-white rounded-xl p-6 card-shadow mb-6">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Kelas</label>
                        <select id="student-class-select" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                            <option value="">-- Pilih Kelas --</option>
                            <option value="7.1">7.1</option>
                            <option value="7.2">7.2</option>
                            <option value="7.3">7.3</option>
                            <option value="7.4">7.4</option>
                            <option value="8.1">8.1</option>
                            <option value="8.2">8.2</option>
                            <option value="8.3">8.3</option>
                            <option value="8.4">8.4</option>
                            <option value="9.1">9.1</option>
                            <option value="9.2">9.2</option>
                            <option value="9.3">9.3</option>
                            <option value="9.4">9.4</option>
                            <option value="X.A">X.A</option>
                            <option value="X.B">X.B</option>
                            <option value="XI.A">XI.A</option>
                            <option value="XI.B">XI.B</option>
                            <option value="XII.A">XII.A</option>
                            <option value="XII.B">XII.B</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Nama</label>
                        <select id="student-name-select" class="w-full border border-gray-300 rounded-lg px-3 py-2" disabled>
                            <option value="">-- Pilih Nama --</option>
                        </select>
                    </div>
                </div>
                <button onclick="loadStudentData()" class="w-full mt-4 btn-primary text-white py-3 rounded-lg font-semibold">
                    <i class="fas fa-search mr-2"></i>Lihat Data
                </button>
            </div>
            
            <div id="student-data" class="hidden">
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white rounded-xl p-6 card-shadow">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-calendar-check mr-2 text-green-500"></i>Rekap Presensi
                        </h3>
                        <div id="student-attendance">
                            <!-- Student attendance will be populated here -->
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 card-shadow">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-star mr-2 text-yellow-500"></i>Nilai & Grade
                        </h3>
                        <div id="student-grades">
                            <!-- Student grades will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Spreadsheet Page -->
    <div id="spreadsheet-page" class="page hidden fade-in">
        <div class="container mx-auto px-4 py-8">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800">Spreadsheet Data Presensi & Nilai</h2>
                <div class="flex space-x-2">
                    <button onclick="exportToCSV()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all">
                        <i class="fas fa-download mr-2"></i>Export CSV
                    </button>
                    <button onclick="exportToExcel()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-all">
                        <i class="fas fa-file-excel mr-2"></i>Export Excel
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 card-shadow mb-6">
                <div class="flex flex-wrap gap-4 items-center mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Kelas</label>
                        <select id="spreadsheet-class-select" class="border border-gray-300 rounded-lg px-3 py-2" onchange="loadSpreadsheetData()">
                            <option value="">-- Pilih Kelas --</option>
                            <option value="7.1">7.1</option>
                            <option value="7.2">7.2</option>
                            <option value="7.3">7.3</option>
                            <option value="7.4">7.4</option>
                            <option value="8.1">8.1</option>
                            <option value="8.2">8.2</option>
                            <option value="8.3">8.3</option>
                            <option value="8.4">8.4</option>
                            <option value="9.1">9.1</option>
                            <option value="9.2">9.2</option>
                            <option value="9.3">9.3</option>
                            <option value="9.4">9.4</option>
                            <option value="X.A">X.A</option>
                            <option value="X.B">X.B</option>
                            <option value="XI.A">XI.A</option>
                            <option value="XI.B">XI.B</option>
                            <option value="XII.A">XII.A</option>
                            <option value="XII.B">XII.B</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tampilan</label>
                        <select id="spreadsheet-view" class="border border-gray-300 rounded-lg px-3 py-2" onchange="loadSpreadsheetData()">
                            <option value="attendance">Presensi</option>
                            <option value="grades">Nilai</option>
                            <option value="complete">Lengkap</option>
                        </select>
                    </div>
                </div>

                <div id="spreadsheet-container" class="overflow-auto max-h-96 border border-gray-300 rounded-lg">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-table text-4xl mb-4"></i>
                        <p>Pilih kelas untuk menampilkan data spreadsheet</p>
                    </div>
                </div>
            </div>

            <!-- Summary Statistics -->
            <div id="spreadsheet-stats" class="hidden">
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-white rounded-xl p-6 card-shadow">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-users mr-2 text-blue-500"></i>Statistik Kelas
                        </h3>
                        <div id="class-stats">
                            <!-- Class statistics will be populated here -->
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 card-shadow">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-calendar-check mr-2 text-green-500"></i>Kehadiran
                        </h3>
                        <div id="attendance-summary">
                            <!-- Attendance summary will be populated here -->
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 card-shadow">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-star mr-2 text-yellow-500"></i>Nilai
                        </h3>
                        <div id="grades-summary">
                            <!-- Grades summary will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="add-student-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Tambah Siswa Baru</h3>
            <form onsubmit="saveNewStudent(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Siswa</label>
                    <input type="text" id="new-student-name" class="w-full border border-gray-300 rounded-lg px-3 py-2" required>
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="closeModal('add-student-modal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg">Batal</button>
                    <button type="submit" class="flex-1 btn-primary text-white py-2 rounded-lg">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="edit-student-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Edit Nama Siswa</h3>
            <form onsubmit="saveEditStudent(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Siswa</label>
                    <input type="text" id="edit-student-name" class="w-full border border-gray-300 rounded-lg px-3 py-2" required>
                    <input type="hidden" id="edit-student-old-name">
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="closeModal('edit-student-modal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg">Batal</button>
                    <button type="submit" class="flex-1 btn-primary text-white py-2 rounded-lg">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let currentClass = '';
        let currentTab = 'attendance';
        let studentsData = {};
        
        // Sample data structure
        const sampleStudents = {
            '7.1': [],
            '7.2': [],
            '7.3': [],
            '7.4': [],
            '8.1': [],
            '8.2': [],
            '8.3': [],
            '8.4': [],
            '9.1': [],
            '9.2': [],
            '9.3': [],
            '9.4': [],
            'X.A': [],
            'X.B': [],
            'XI.A': [],
            'XI.B': [],
            'XII.A': [],
            'XII.B': []
        };

        // Initialize data structure for each class
        Object.keys(sampleStudents).forEach(className => {
            studentsData[className] = {};
        });

        // Page navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId + '-page').classList.remove('hidden');
        }

        // Teacher login
        function teacherLogin(event) {
            event.preventDefault();
            const password = document.getElementById('teacher-password').value;
            
            if (password === 'guru1234') {
                showPage('teacher-dashboard');
                document.getElementById('teacher-password').value = '';
            }
        }

        // Logout
        function logout() {
            showPage('home');
        }

        // Select class
        function selectClass(className) {
            currentClass = className;
            document.getElementById('current-class').textContent = className;
            showPage('class-management');
            showTab('attendance');
            loadAttendanceTable();
        }

        // Tab navigation
        function showTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('[id$="-tab"]').forEach(tab => {
                tab.classList.remove('bg-blue-500', 'text-white');
                tab.classList.add('bg-gray-300', 'text-gray-700');
            });
            document.getElementById(tabName + '-tab').classList.remove('bg-gray-300', 'text-gray-700');
            document.getElementById(tabName + '-tab').classList.add('bg-blue-500', 'text-white');
            
            // Show/hide content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(tabName + '-content').classList.remove('hidden');
            
            // Load appropriate data
            if (tabName === 'attendance') {
                loadAttendanceTable();
            } else if (tabName === 'grades') {
                loadGradesTable();
            } else if (tabName === 'recap') {
                loadRecapData();
            } else if (tabName === 'spreadsheet') {
                loadClassSpreadsheetData();
            }
        }

        // Load attendance table
        function loadAttendanceTable() {
            const tbody = document.getElementById('attendance-table');
            const students = sampleStudents[currentClass] || [];
            
            tbody.innerHTML = '';
            students.forEach((name, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                
                const currentMeeting = document.getElementById('meeting-select').value;
                const isPresent = studentsData[currentClass][name].attendance[currentMeeting];
                
                row.innerHTML = `
                    <td class="px-4 py-3">${index + 1}</td>
                    <td class="px-4 py-3 font-medium">${name}</td>
                    <td class="px-4 py-3 text-center">
                        <div class="flex justify-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="attendance-${index}" value="present" ${isPresent ? 'checked' : ''} 
                                       onchange="updateAttendance('${name}', true)" class="mr-2">
                                <span class="text-green-600">Hadir</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="attendance-${index}" value="absent" ${!isPresent ? 'checked' : ''} 
                                       onchange="updateAttendance('${name}', false)" class="mr-2">
                                <span class="text-red-600">Tidak Hadir</span>
                            </label>
                        </div>
                    </td>
                    <td class="px-4 py-3 text-center">
                        <button onclick="editStudent('${name}')" class="text-blue-500 hover:text-blue-700 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteStudent('${name}')" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update attendance
        function updateAttendance(studentName, isPresent) {
            const currentMeeting = document.getElementById('meeting-select').value;
            studentsData[currentClass][studentName].attendance[currentMeeting] = isPresent;
            
            // Simulate saving to Google Sheets
            console.log(`Attendance updated for ${studentName} in ${currentClass}, Meeting ${currentMeeting}: ${isPresent ? 'Present' : 'Absent'}`);
        }

        // Mark all present
        function markAllPresent() {
            const students = sampleStudents[currentClass] || [];
            const currentMeeting = document.getElementById('meeting-select').value;
            
            students.forEach(name => {
                studentsData[currentClass][name].attendance[currentMeeting] = true;
            });
            
            loadAttendanceTable();
        }

        // Load grades table
        function loadGradesTable() {
            const tbody = document.getElementById('grades-table');
            const students = sampleStudents[currentClass] || [];
            
            tbody.innerHTML = '';
            students.forEach((name, index) => {
                const grades = studentsData[currentClass][name].grades;
                const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
                const attendancePercentage = calculateAttendancePercentage(name);
                const finalGrade = (attendancePercentage * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4);
                
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3">${index + 1}</td>
                    <td class="px-4 py-3 font-medium">${name}</td>
                    <td class="px-4 py-3 text-center">
                        <input type="number" value="${grades.tugas1}" min="0" max="100" 
                               onchange="updateGrade('${name}', 'tugas1', this.value)"
                               class="w-16 text-center border border-gray-300 rounded px-2 py-1">
                    </td>
                    <td class="px-4 py-3 text-center">
                        <input type="number" value="${grades.tugas2}" min="0" max="100" 
                               onchange="updateGrade('${name}', 'tugas2', this.value)"
                               class="w-16 text-center border border-gray-300 rounded px-2 py-1">
                    </td>
                    <td class="px-4 py-3 text-center">
                        <input type="number" value="${grades.tugas3}" min="0" max="100" 
                               onchange="updateGrade('${name}', 'tugas3', this.value)"
                               class="w-16 text-center border border-gray-300 rounded px-2 py-1">
                    </td>
                    <td class="px-4 py-3 text-center">
                        <input type="number" value="${grades.tugas4}" min="0" max="100" 
                               onchange="updateGrade('${name}', 'tugas4', this.value)"
                               class="w-16 text-center border border-gray-300 rounded px-2 py-1">
                    </td>
                    <td class="px-4 py-3 text-center">
                        <input type="number" value="${grades.uts}" min="0" max="100" 
                               onchange="updateGrade('${name}', 'uts', this.value)"
                               class="w-16 text-center border border-gray-300 rounded px-2 py-1">
                    </td>
                    <td class="px-4 py-3 text-center">
                        <input type="number" value="${grades.uas}" min="0" max="100" 
                               onchange="updateGrade('${name}', 'uas', this.value)"
                               class="w-16 text-center border border-gray-300 rounded px-2 py-1">
                    </td>
                    <td class="px-4 py-3 text-center font-bold ${finalGrade >= 75 ? 'text-green-600' : finalGrade >= 60 ? 'text-yellow-600' : 'text-red-600'}">
                        ${finalGrade.toFixed(1)}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update grade
        function updateGrade(studentName, gradeType, value) {
            studentsData[currentClass][studentName].grades[gradeType] = parseInt(value);
            
            // Simulate saving to Google Sheets
            console.log(`Grade updated for ${studentName} in ${currentClass}, ${gradeType}: ${value}`);
        }

        // Calculate attendance percentage
        function calculateAttendancePercentage(studentName) {
            const attendance = studentsData[currentClass][studentName].attendance;
            const totalMeetings = Object.keys(attendance).length;
            const presentCount = Object.values(attendance).filter(present => present).length;
            return totalMeetings > 0 ? (presentCount / totalMeetings) * 100 : 0;
        }

        // Load recap data
        function loadRecapData() {
            loadAttendanceStats();
            loadGradeStats();
            loadRecapTable();
        }

        // Load attendance statistics
        function loadAttendanceStats() {
            const statsDiv = document.getElementById('attendance-stats');
            const students = sampleStudents[currentClass] || [];
            
            let totalPresent = 0;
            let totalMeetings = 0;
            
            students.forEach(name => {
                const attendance = studentsData[currentClass][name].attendance;
                totalMeetings += Object.keys(attendance).length;
                totalPresent += Object.values(attendance).filter(present => present).length;
            });
            
            const overallPercentage = totalMeetings > 0 ? (totalPresent / totalMeetings) * 100 : 0;
            
            statsDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span>Total Siswa:</span>
                        <span class="font-bold">${students.length}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Rata-rata Kehadiran:</span>
                        <span class="font-bold text-green-600">${overallPercentage.toFixed(1)}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: ${overallPercentage}%"></div>
                    </div>
                </div>
            `;
        }

        // Load grade statistics
        function loadGradeStats() {
            const statsDiv = document.getElementById('grade-stats');
            const students = sampleStudents[currentClass] || [];
            
            let totalFinalGrade = 0;
            let gradeA = 0, gradeB = 0, gradeC = 0, gradeD = 0;
            
            students.forEach(name => {
                const grades = studentsData[currentClass][name].grades;
                const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
                const attendancePercentage = calculateAttendancePercentage(name);
                const finalGrade = (attendancePercentage * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4);
                
                totalFinalGrade += finalGrade;
                
                if (finalGrade >= 85) gradeA++;
                else if (finalGrade >= 75) gradeB++;
                else if (finalGrade >= 60) gradeC++;
                else gradeD++;
            });
            
            const avgFinalGrade = students.length > 0 ? totalFinalGrade / students.length : 0;
            
            statsDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span>Rata-rata Nilai:</span>
                        <span class="font-bold">${avgFinalGrade.toFixed(1)}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="flex justify-between">
                            <span>Grade A:</span>
                            <span class="font-bold text-green-600">${gradeA}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Grade B:</span>
                            <span class="font-bold text-blue-600">${gradeB}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Grade C:</span>
                            <span class="font-bold text-yellow-600">${gradeC}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Grade D:</span>
                            <span class="font-bold text-red-600">${gradeD}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load recap table
        function loadRecapTable() {
            const tbody = document.getElementById('recap-table');
            const students = sampleStudents[currentClass] || [];
            
            tbody.innerHTML = '';
            students.forEach((name, index) => {
                const grades = studentsData[currentClass][name].grades;
                const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
                const attendancePercentage = calculateAttendancePercentage(name);
                const finalGrade = (attendancePercentage * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4);
                
                let grade = 'D';
                if (finalGrade >= 85) grade = 'A';
                else if (finalGrade >= 75) grade = 'B';
                else if (finalGrade >= 60) grade = 'C';
                
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3">${index + 1}</td>
                    <td class="px-4 py-3 font-medium">${name}</td>
                    <td class="px-4 py-3 text-center">${attendancePercentage.toFixed(1)}%</td>
                    <td class="px-4 py-3 text-center">${avgTugas.toFixed(1)}</td>
                    <td class="px-4 py-3 text-center">${grades.uts}</td>
                    <td class="px-4 py-3 text-center">${grades.uas}</td>
                    <td class="px-4 py-3 text-center font-bold">${finalGrade.toFixed(1)}</td>
                    <td class="px-4 py-3 text-center">
                        <span class="px-2 py-1 rounded text-sm font-bold ${
                            grade === 'A' ? 'bg-green-100 text-green-800' :
                            grade === 'B' ? 'bg-blue-100 text-blue-800' :
                            grade === 'C' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                        }">${grade}</span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Student portal functions
        document.getElementById('student-class-select').addEventListener('change', function() {
            const selectedClass = this.value;
            const nameSelect = document.getElementById('student-name-select');
            
            nameSelect.innerHTML = '<option value="">-- Pilih Nama --</option>';
            
            if (selectedClass && sampleStudents[selectedClass]) {
                nameSelect.disabled = false;
                sampleStudents[selectedClass].forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    nameSelect.appendChild(option);
                });
            } else {
                nameSelect.disabled = true;
            }
        });

        // Load student data
        function loadStudentData() {
            const selectedClass = document.getElementById('student-class-select').value;
            const selectedName = document.getElementById('student-name-select').value;
            
            if (!selectedClass || !selectedName) {
                alert('Silakan pilih kelas dan nama terlebih dahulu!');
                return;
            }
            
            const studentData = studentsData[selectedClass][selectedName];
            const attendanceDiv = document.getElementById('student-attendance');
            const gradesDiv = document.getElementById('student-grades');
            
            // Load attendance data
            const attendancePercentage = calculateAttendancePercentage(selectedName);
            const attendance = studentData.attendance;
            const presentCount = Object.values(attendance).filter(present => present).length;
            const totalMeetings = Object.keys(attendance).length;
            
            attendanceDiv.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-600">${attendancePercentage.toFixed(1)}%</div>
                        <div class="text-sm text-gray-600">Persentase Kehadiran</div>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>Hadir: <strong class="text-green-600">${presentCount}</strong></span>
                        <span>Total: <strong>${totalMeetings}</strong></span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-green-500 h-3 rounded-full" style="width: ${attendancePercentage}%"></div>
                    </div>
                </div>
            `;
            
            // Load grades data
            const grades = studentData.grades;
            const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
            const finalGrade = (attendancePercentage * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4);
            
            let grade = 'D';
            if (finalGrade >= 85) grade = 'A';
            else if (finalGrade >= 75) grade = 'B';
            else if (finalGrade >= 60) grade = 'C';
            
            gradesDiv.innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="flex justify-between">
                            <span>Tugas 1:</span>
                            <span class="font-bold">${grades.tugas1}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Tugas 2:</span>
                            <span class="font-bold">${grades.tugas2}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Tugas 3:</span>
                            <span class="font-bold">${grades.tugas3}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Tugas 4:</span>
                            <span class="font-bold">${grades.tugas4}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>UTS:</span>
                            <span class="font-bold">${grades.uts}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>UAS:</span>
                            <span class="font-bold">${grades.uas}</span>
                        </div>
                    </div>
                    <hr>
                    <div class="text-center">
                        <div class="text-2xl font-bold">${finalGrade.toFixed(1)}</div>
                        <div class="text-sm text-gray-600 mb-2">Nilai Akhir</div>
                        <span class="px-3 py-1 rounded-full text-sm font-bold ${
                            grade === 'A' ? 'bg-green-100 text-green-800' :
                            grade === 'B' ? 'bg-blue-100 text-blue-800' :
                            grade === 'C' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                        }">Grade ${grade}</span>
                    </div>
                </div>
            `;
            
            document.getElementById('student-data').classList.remove('hidden');
        }

        // Class Spreadsheet functions
        function loadClassSpreadsheetData() {
            if (!currentClass) return;
            
            const students = sampleStudents[currentClass] || [];
            const viewType = document.getElementById('class-spreadsheet-view').value;
            let tableHTML = '';
            
            if (viewType === 'attendance') {
                tableHTML = generateAttendanceSpreadsheet(currentClass, students);
            } else if (viewType === 'grades') {
                tableHTML = generateGradesSpreadsheet(currentClass, students);
            } else {
                tableHTML = generateCompleteSpreadsheet(currentClass, students);
            }
            
            document.getElementById('class-spreadsheet-container').innerHTML = tableHTML;
            loadClassSpreadsheetStats(currentClass, students);
        }

        function loadClassSpreadsheetStats(className, students) {
            // Class stats
            const classStatsDiv = document.getElementById('class-stats-spreadsheet');
            classStatsDiv.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>Kelas:</span>
                        <span class="font-bold">${className}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Total Siswa:</span>
                        <span class="font-bold">${students.length}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Total Pertemuan:</span>
                        <span class="font-bold">16</span>
                    </div>
                </div>
            `;
            
            // Attendance summary
            let totalPresent = 0;
            let totalMeetings = 0;
            students.forEach(name => {
                const attendance = studentsData[className][name].attendance;
                totalMeetings += Object.keys(attendance).length;
                totalPresent += Object.values(attendance).filter(present => present).length;
            });
            const overallAttendance = totalMeetings > 0 ? (totalPresent / totalMeetings) * 100 : 0;
            
            const attendanceSummaryDiv = document.getElementById('attendance-summary-spreadsheet');
            attendanceSummaryDiv.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>Rata-rata:</span>
                        <span class="font-bold text-green-600">${overallAttendance.toFixed(1)}%</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Total Hadir:</span>
                        <span class="font-bold">${totalPresent}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: ${overallAttendance}%"></div>
                    </div>
                </div>
            `;
            
            // Grades summary
            let totalFinalGrade = 0;
            let gradeA = 0, gradeB = 0, gradeC = 0, gradeD = 0;
            
            students.forEach(name => {
                const grades = studentsData[className][name].grades;
                const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
                const attendancePercentage = calculateAttendancePercentage(name);
                const finalGrade = (attendancePercentage * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4);
                
                totalFinalGrade += finalGrade;
                
                if (finalGrade >= 85) gradeA++;
                else if (finalGrade >= 75) gradeB++;
                else if (finalGrade >= 60) gradeC++;
                else gradeD++;
            });
            
            const avgFinalGrade = students.length > 0 ? totalFinalGrade / students.length : 0;
            
            const gradesSummaryDiv = document.getElementById('grades-summary-spreadsheet');
            gradesSummaryDiv.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>Rata-rata:</span>
                        <span class="font-bold">${avgFinalGrade.toFixed(1)}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-1 text-xs">
                        <div class="flex justify-between">
                            <span>A:</span>
                            <span class="font-bold text-green-600">${gradeA}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>B:</span>
                            <span class="font-bold text-blue-600">${gradeB}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>C:</span>
                            <span class="font-bold text-yellow-600">${gradeC}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>D:</span>
                            <span class="font-bold text-red-600">${gradeD}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Export functions for class
        function exportClassToCSV() {
            if (!currentClass) {
                alert('Tidak ada kelas yang dipilih!');
                return;
            }
            
            const students = sampleStudents[currentClass] || [];
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Header
            csvContent += "No,Nama Siswa,";
            for (let i = 1; i <= 16; i++) {
                csvContent += `Pertemuan ${i},`;
            }
            csvContent += "Kehadiran %,Tugas 1,Tugas 2,Tugas 3,Tugas 4,UTS,UAS,Nilai Akhir,Grade\n";
            
            // Data
            students.forEach((name, index) => {
                const attendance = studentsData[currentClass][name].attendance;
                const grades = studentsData[currentClass][name].grades;
                const presentCount = Object.values(attendance).filter(present => present).length;
                const attendancePercentage = ((presentCount / 16) * 100).toFixed(1);
                const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
                const finalGrade = ((parseFloat(attendancePercentage) * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4)).toFixed(1);
                
                let grade = 'D';
                if (finalGrade >= 85) grade = 'A';
                else if (finalGrade >= 75) grade = 'B';
                else if (finalGrade >= 60) grade = 'C';
                
                csvContent += `${index + 1},"${name}",`;
                for (let i = 1; i <= 16; i++) {
                    csvContent += `${attendance[i] ? 'Hadir' : 'Tidak Hadir'},`;
                }
                csvContent += `${attendancePercentage}%,${grades.tugas1},${grades.tugas2},${grades.tugas3},${grades.tugas4},${grades.uts},${grades.uas},${finalGrade},${grade}\n`;
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `Data_Kelas_${currentClass}_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportClassToExcel() {
            if (!currentClass) {
                alert('Tidak ada kelas yang dipilih!');
                return;
            }
            
            // Create a simple HTML table for Excel export
            const students = sampleStudents[currentClass] || [];
            let excelContent = `
                <table border="1">
                    <tr>
                        <th>No</th>
                        <th>Nama Siswa</th>`;
            
            for (let i = 1; i <= 16; i++) {
                excelContent += `<th>Pertemuan ${i}</th>`;
            }
            excelContent += `
                        <th>Kehadiran %</th>
                        <th>Tugas 1</th>
                        <th>Tugas 2</th>
                        <th>Tugas 3</th>
                        <th>Tugas 4</th>
                        <th>UTS</th>
                        <th>UAS</th>
                        <th>Nilai Akhir</th>
                        <th>Grade</th>
                    </tr>`;
            
            students.forEach((name, index) => {
                const attendance = studentsData[currentClass][name].attendance;
                const grades = studentsData[currentClass][name].grades;
                const presentCount = Object.values(attendance).filter(present => present).length;
                const attendancePercentage = ((presentCount / 16) * 100).toFixed(1);
                const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
                const finalGrade = ((parseFloat(attendancePercentage) * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4)).toFixed(1);
                
                let grade = 'D';
                if (finalGrade >= 85) grade = 'A';
                else if (finalGrade >= 75) grade = 'B';
                else if (finalGrade >= 60) grade = 'C';
                
                excelContent += `<tr>
                    <td>${index + 1}</td>
                    <td>${name}</td>`;
                
                for (let i = 1; i <= 16; i++) {
                    excelContent += `<td>${attendance[i] ? 'Hadir' : 'Tidak Hadir'}</td>`;
                }
                
                excelContent += `
                    <td>${attendancePercentage}%</td>
                    <td>${grades.tugas1}</td>
                    <td>${grades.tugas2}</td>
                    <td>${grades.tugas3}</td>
                    <td>${grades.tugas4}</td>
                    <td>${grades.uts}</td>
                    <td>${grades.uas}</td>
                    <td>${finalGrade}</td>
                    <td>${grade}</td>
                </tr>`;
            });
            
            excelContent += '</table>';
            
            const blob = new Blob([excelContent], { type: 'application/vnd.ms-excel' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `Data_Kelas_${currentClass}_${new Date().toISOString().split('T')[0]}.xls`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // Spreadsheet functions
        function loadSpreadsheetData() {
            const selectedClass = document.getElementById('spreadsheet-class-select').value;
            const viewType = document.getElementById('spreadsheet-view').value;
            
            if (!selectedClass) {
                document.getElementById('spreadsheet-container').innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-table text-4xl mb-4"></i>
                        <p>Pilih kelas untuk menampilkan data spreadsheet</p>
                    </div>
                `;
                document.getElementById('spreadsheet-stats').classList.add('hidden');
                return;
            }
            
            const students = sampleStudents[selectedClass] || [];
            let tableHTML = '';
            
            if (viewType === 'attendance') {
                tableHTML = generateAttendanceSpreadsheet(selectedClass, students);
            } else if (viewType === 'grades') {
                tableHTML = generateGradesSpreadsheet(selectedClass, students);
            } else {
                tableHTML = generateCompleteSpreadsheet(selectedClass, students);
            }
            
            document.getElementById('spreadsheet-container').innerHTML = tableHTML;
            loadSpreadsheetStats(selectedClass, students);
            document.getElementById('spreadsheet-stats').classList.remove('hidden');
        }

        function generateAttendanceSpreadsheet(className, students) {
            let html = '<table class="spreadsheet-table w-full">';
            
            // Header
            html += '<thead><tr>';
            html += '<th class="student-name">No</th>';
            html += '<th class="student-name">Nama Siswa</th>';
            for (let i = 1; i <= 16; i++) {
                html += `<th>P${i}</th>`;
            }
            html += '<th>Hadir</th>';
            html += '<th>%</th>';
            html += '</tr></thead>';
            
            // Body
            html += '<tbody>';
            students.forEach((name, index) => {
                const attendance = studentsData[className][name].attendance;
                const presentCount = Object.values(attendance).filter(present => present).length;
                const percentage = ((presentCount / 16) * 100).toFixed(1);
                
                html += '<tr>';
                html += `<td class="student-name">${index + 1}</td>`;
                html += `<td class="student-name">${name}</td>`;
                
                for (let i = 1; i <= 16; i++) {
                    const isPresent = attendance[i];
                    html += `<td class="${isPresent ? 'present' : 'absent'}">${isPresent ? '✓' : '✗'}</td>`;
                }
                
                html += `<td class="font-bold">${presentCount}</td>`;
                html += `<td class="font-bold">${percentage}%</td>`;
                html += '</tr>';
            });
            html += '</tbody></table>';
            
            return html;
        }

        function generateGradesSpreadsheet(className, students) {
            let html = '<table class="spreadsheet-table w-full">';
            
            // Header
            html += '<thead><tr>';
            html += '<th class="student-name">No</th>';
            html += '<th class="student-name">Nama Siswa</th>';
            html += '<th>T1</th>';
            html += '<th>T2</th>';
            html += '<th>T3</th>';
            html += '<th>T4</th>';
            html += '<th>Avg T</th>';
            html += '<th>UTS</th>';
            html += '<th>UAS</th>';
            html += '<th>Final</th>';
            html += '<th>Grade</th>';
            html += '</tr></thead>';
            
            // Body
            html += '<tbody>';
            students.forEach((name, index) => {
                const grades = studentsData[className][name].grades;
                const avgTugas = ((grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4).toFixed(1);
                const attendancePercentage = calculateAttendancePercentage(name);
                const finalGrade = ((attendancePercentage * 0.1) + (parseFloat(avgTugas) * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4)).toFixed(1);
                
                let grade = 'D';
                let gradeClass = 'grade-d';
                if (finalGrade >= 85) { grade = 'A'; gradeClass = 'grade-a'; }
                else if (finalGrade >= 75) { grade = 'B'; gradeClass = 'grade-b'; }
                else if (finalGrade >= 60) { grade = 'C'; gradeClass = 'grade-c'; }
                
                html += '<tr>';
                html += `<td class="student-name">${index + 1}</td>`;
                html += `<td class="student-name">${name}</td>`;
                html += `<td>${grades.tugas1}</td>`;
                html += `<td>${grades.tugas2}</td>`;
                html += `<td>${grades.tugas3}</td>`;
                html += `<td>${grades.tugas4}</td>`;
                html += `<td class="font-bold">${avgTugas}</td>`;
                html += `<td>${grades.uts}</td>`;
                html += `<td>${grades.uas}</td>`;
                html += `<td class="font-bold">${finalGrade}</td>`;
                html += `<td class="${gradeClass} font-bold">${grade}</td>`;
                html += '</tr>';
            });
            html += '</tbody></table>';
            
            return html;
        }

        function generateCompleteSpreadsheet(className, students) {
            let html = '<table class="spreadsheet-table w-full">';
            
            // Header
            html += '<thead><tr>';
            html += '<th class="student-name">No</th>';
            html += '<th class="student-name">Nama Siswa</th>';
            
            // Attendance columns
            for (let i = 1; i <= 16; i++) {
                html += `<th>P${i}</th>`;
            }
            html += '<th>%Hadir</th>';
            
            // Grades columns
            html += '<th>T1</th>';
            html += '<th>T2</th>';
            html += '<th>T3</th>';
            html += '<th>T4</th>';
            html += '<th>UTS</th>';
            html += '<th>UAS</th>';
            html += '<th>Final</th>';
            html += '<th>Grade</th>';
            html += '</tr></thead>';
            
            // Body
            html += '<tbody>';
            students.forEach((name, index) => {
                const attendance = studentsData[className][name].attendance;
                const grades = studentsData[className][name].grades;
                const presentCount = Object.values(attendance).filter(present => present).length;
                const attendancePercentage = ((presentCount / 16) * 100).toFixed(1);
                const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
                const finalGrade = ((parseFloat(attendancePercentage) * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4)).toFixed(1);
                
                let grade = 'D';
                let gradeClass = 'grade-d';
                if (finalGrade >= 85) { grade = 'A'; gradeClass = 'grade-a'; }
                else if (finalGrade >= 75) { grade = 'B'; gradeClass = 'grade-b'; }
                else if (finalGrade >= 60) { grade = 'C'; gradeClass = 'grade-c'; }
                
                html += '<tr>';
                html += `<td class="student-name">${index + 1}</td>`;
                html += `<td class="student-name">${name}</td>`;
                
                // Attendance data
                for (let i = 1; i <= 16; i++) {
                    const isPresent = attendance[i];
                    html += `<td class="${isPresent ? 'present' : 'absent'}">${isPresent ? '✓' : '✗'}</td>`;
                }
                html += `<td class="font-bold">${attendancePercentage}%</td>`;
                
                // Grades data
                html += `<td>${grades.tugas1}</td>`;
                html += `<td>${grades.tugas2}</td>`;
                html += `<td>${grades.tugas3}</td>`;
                html += `<td>${grades.tugas4}</td>`;
                html += `<td>${grades.uts}</td>`;
                html += `<td>${grades.uas}</td>`;
                html += `<td class="font-bold">${finalGrade}</td>`;
                html += `<td class="${gradeClass} font-bold">${grade}</td>`;
                html += '</tr>';
            });
            html += '</tbody></table>';
            
            return html;
        }

        function loadSpreadsheetStats(className, students) {
            // Class stats
            const classStatsDiv = document.getElementById('class-stats');
            classStatsDiv.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>Kelas:</span>
                        <span class="font-bold">${className}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Total Siswa:</span>
                        <span class="font-bold">${students.length}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Total Pertemuan:</span>
                        <span class="font-bold">16</span>
                    </div>
                </div>
            `;
            
            // Attendance summary
            let totalPresent = 0;
            let totalMeetings = 0;
            students.forEach(name => {
                const attendance = studentsData[className][name].attendance;
                totalMeetings += Object.keys(attendance).length;
                totalPresent += Object.values(attendance).filter(present => present).length;
            });
            const overallAttendance = totalMeetings > 0 ? (totalPresent / totalMeetings) * 100 : 0;
            
            const attendanceSummaryDiv = document.getElementById('attendance-summary');
            attendanceSummaryDiv.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>Rata-rata:</span>
                        <span class="font-bold text-green-600">${overallAttendance.toFixed(1)}%</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Total Hadir:</span>
                        <span class="font-bold">${totalPresent}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: ${overallAttendance}%"></div>
                    </div>
                </div>
            `;
            
            // Grades summary
            let totalFinalGrade = 0;
            let gradeA = 0, gradeB = 0, gradeC = 0, gradeD = 0;
            
            students.forEach(name => {
                const grades = studentsData[className][name].grades;
                const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
                const attendancePercentage = calculateAttendancePercentage(name);
                const finalGrade = (attendancePercentage * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4);
                
                totalFinalGrade += finalGrade;
                
                if (finalGrade >= 85) gradeA++;
                else if (finalGrade >= 75) gradeB++;
                else if (finalGrade >= 60) gradeC++;
                else gradeD++;
            });
            
            const avgFinalGrade = students.length > 0 ? totalFinalGrade / students.length : 0;
            
            const gradesSummaryDiv = document.getElementById('grades-summary');
            gradesSummaryDiv.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>Rata-rata:</span>
                        <span class="font-bold">${avgFinalGrade.toFixed(1)}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-1 text-xs">
                        <div class="flex justify-between">
                            <span>A:</span>
                            <span class="font-bold text-green-600">${gradeA}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>B:</span>
                            <span class="font-bold text-blue-600">${gradeB}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>C:</span>
                            <span class="font-bold text-yellow-600">${gradeC}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>D:</span>
                            <span class="font-bold text-red-600">${gradeD}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Export functions
        function exportToCSV() {
            const selectedClass = document.getElementById('spreadsheet-class-select').value;
            if (!selectedClass) {
                alert('Pilih kelas terlebih dahulu!');
                return;
            }
            
            const students = sampleStudents[selectedClass] || [];
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Header
            csvContent += "No,Nama Siswa,";
            for (let i = 1; i <= 16; i++) {
                csvContent += `Pertemuan ${i},`;
            }
            csvContent += "Kehadiran %,Tugas 1,Tugas 2,Tugas 3,Tugas 4,UTS,UAS,Nilai Akhir,Grade\n";
            
            // Data
            students.forEach((name, index) => {
                const attendance = studentsData[selectedClass][name].attendance;
                const grades = studentsData[selectedClass][name].grades;
                const presentCount = Object.values(attendance).filter(present => present).length;
                const attendancePercentage = ((presentCount / 16) * 100).toFixed(1);
                const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
                const finalGrade = ((parseFloat(attendancePercentage) * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4)).toFixed(1);
                
                let grade = 'D';
                if (finalGrade >= 85) grade = 'A';
                else if (finalGrade >= 75) grade = 'B';
                else if (finalGrade >= 60) grade = 'C';
                
                csvContent += `${index + 1},"${name}",`;
                for (let i = 1; i <= 16; i++) {
                    csvContent += `${attendance[i] ? 'Hadir' : 'Tidak Hadir'},`;
                }
                csvContent += `${attendancePercentage}%,${grades.tugas1},${grades.tugas2},${grades.tugas3},${grades.tugas4},${grades.uts},${grades.uas},${finalGrade},${grade}\n`;
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `Data_Kelas_${selectedClass}_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportToExcel() {
            const selectedClass = document.getElementById('spreadsheet-class-select').value;
            if (!selectedClass) {
                alert('Pilih kelas terlebih dahulu!');
                return;
            }
            
            // Create a simple HTML table for Excel export
            const students = sampleStudents[selectedClass] || [];
            let excelContent = `
                <table border="1">
                    <tr>
                        <th>No</th>
                        <th>Nama Siswa</th>`;
            
            for (let i = 1; i <= 16; i++) {
                excelContent += `<th>Pertemuan ${i}</th>`;
            }
            excelContent += `
                        <th>Kehadiran %</th>
                        <th>Tugas 1</th>
                        <th>Tugas 2</th>
                        <th>Tugas 3</th>
                        <th>Tugas 4</th>
                        <th>UTS</th>
                        <th>UAS</th>
                        <th>Nilai Akhir</th>
                        <th>Grade</th>
                    </tr>`;
            
            students.forEach((name, index) => {
                const attendance = studentsData[selectedClass][name].attendance;
                const grades = studentsData[selectedClass][name].grades;
                const presentCount = Object.values(attendance).filter(present => present).length;
                const attendancePercentage = ((presentCount / 16) * 100).toFixed(1);
                const avgTugas = (grades.tugas1 + grades.tugas2 + grades.tugas3 + grades.tugas4) / 4;
                const finalGrade = ((parseFloat(attendancePercentage) * 0.1) + (avgTugas * 0.2) + (grades.uts * 0.3) + (grades.uas * 0.4)).toFixed(1);
                
                let grade = 'D';
                if (finalGrade >= 85) grade = 'A';
                else if (finalGrade >= 75) grade = 'B';
                else if (finalGrade >= 60) grade = 'C';
                
                excelContent += `<tr>
                    <td>${index + 1}</td>
                    <td>${name}</td>`;
                
                for (let i = 1; i <= 16; i++) {
                    excelContent += `<td>${attendance[i] ? 'Hadir' : 'Tidak Hadir'}</td>`;
                }
                
                excelContent += `
                    <td>${attendancePercentage}%</td>
                    <td>${grades.tugas1}</td>
                    <td>${grades.tugas2}</td>
                    <td>${grades.tugas3}</td>
                    <td>${grades.tugas4}</td>
                    <td>${grades.uts}</td>
                    <td>${grades.uas}</td>
                    <td>${finalGrade}</td>
                    <td>${grade}</td>
                </tr>`;
            });
            
            excelContent += '</table>';
            
            const blob = new Blob([excelContent], { type: 'application/vnd.ms-excel' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `Data_Kelas_${selectedClass}_${new Date().toISOString().split('T')[0]}.xls`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // Modal functions
        function addStudent() {
            document.getElementById('add-student-modal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function saveNewStudent(event) {
            event.preventDefault();
            const newName = document.getElementById('new-student-name').value.trim();
            
            if (newName && !sampleStudents[currentClass].includes(newName)) {
                sampleStudents[currentClass].push(newName);
                
                // Initialize data for new student
                studentsData[currentClass][newName] = {
                    attendance: {},
                    grades: {
                        tugas1: 0,
                        tugas2: 0,
                        tugas3: 0,
                        tugas4: 0,
                        uts: 0,
                        uas: 0
                    }
                };
                
                // Initialize attendance for all meetings
                for (let i = 1; i <= 16; i++) {
                    studentsData[currentClass][newName].attendance[i] = false;
                }
                
                loadAttendanceTable();
                closeModal('add-student-modal');
                document.getElementById('new-student-name').value = '';
            }
        }

        function editStudent(studentName) {
            document.getElementById('edit-student-name').value = studentName;
            document.getElementById('edit-student-old-name').value = studentName;
            document.getElementById('edit-student-modal').classList.remove('hidden');
        }

        function saveEditStudent(event) {
            event.preventDefault();
            const oldName = document.getElementById('edit-student-old-name').value;
            const newName = document.getElementById('edit-student-name').value.trim();
            
            if (newName && newName !== oldName && !sampleStudents[currentClass].includes(newName)) {
                // Update in students array
                const index = sampleStudents[currentClass].indexOf(oldName);
                if (index > -1) {
                    sampleStudents[currentClass][index] = newName;
                }
                
                // Transfer data to new name
                studentsData[currentClass][newName] = studentsData[currentClass][oldName];
                delete studentsData[currentClass][oldName];
                
                // Refresh current view
                if (currentTab === 'attendance') {
                    loadAttendanceTable();
                } else if (currentTab === 'grades') {
                    loadGradesTable();
                } else if (currentTab === 'recap') {
                    loadRecapData();
                }
                
                closeModal('edit-student-modal');
                document.getElementById('edit-student-name').value = '';
                document.getElementById('edit-student-old-name').value = '';
            } else if (newName === oldName) {
                closeModal('edit-student-modal');
            } else if (sampleStudents[currentClass].includes(newName)) {
                alert('Nama siswa sudah ada!');
            }
        }

        function deleteStudent(studentName) {
            if (confirm(`Apakah Anda yakin ingin menghapus ${studentName}?`)) {
                const index = sampleStudents[currentClass].indexOf(studentName);
                if (index > -1) {
                    sampleStudents[currentClass].splice(index, 1);
                    delete studentsData[currentClass][studentName];
                    
                    // Refresh current view
                    if (currentTab === 'attendance') {
                        loadAttendanceTable();
                    } else if (currentTab === 'grades') {
                        loadGradesTable();
                    } else if (currentTab === 'recap') {
                        loadRecapData();
                    }
                }
            }
        }

        // Event listeners
        document.getElementById('meeting-select').addEventListener('change', loadAttendanceTable);

        // Set today's date as default
        document.getElementById('meeting-date').valueAsDate = new Date();

        // Initialize the app
        showPage('home');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'967cc402d46ff922',t:'MTc1Mzk2MTQ0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
